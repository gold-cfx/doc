## 镜像管理

### 列出镜像
```
[root@localhost ~]# docker image ls
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello-world         latest              e38bc07ac18e        3 weeks ago         1.85kB
centos              latest              e934aafc2206        4 weeks ago         199MB

```
列表包含了 `仓库名`、`标签`、`镜像 ID`、`创建时间` 以及 `所占用的空间`。

默认的 `docker image ls` 列表中只会显示顶层镜像。如果希望显示包括中间层镜像在内的所有镜像的话，需要加 `-a` 参数。

```
$ docker image ls -a
```

根据仓库名列出镜像

```
$ docker image ls ubuntu
```

列出特定的某个镜像，也就是说指定仓库名和标签

```
$ docker image ls ubuntu:16.04
```

除此以外，`docker image ls` 还支持强大的过滤器参数 `--filter`，或者简写 `-f`。

通过 `-f` 列出虚悬镜像

```
$ docker image ls -f dangling=true
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
<none>              <none>              00285df0df87        5 days ago          342 MB
```
!> 删除虚悬镜像用 `docker image prune`

只显示镜像的 ID

```
$ docker image ls -q
```

利用 `--format` 以特定格式显示

比如，只包含镜像 ID 和仓库名：

```
$ docker image ls --format "{{.ID}}: {{.Repository}}"
```

或者打算以表格等距显示，并且有标题行，和默认一样，不过自己定义列：

```
$ docker image ls --format "table {{.ID}}\t{{.Repository}}\t{{.Tag}}"
```

### 删除镜像

```
$ docker image rm [选项] <镜像1> [<镜像2> ...]
```

其中，`<镜像>` 可以是 `镜像短 ID`、`镜像长 ID`、`镜像名` 或者 `镜像摘要`。

通过 `镜像短ID` 删除
```
$ docker image rm e38
```

通过 `<仓库名>:<标签>` 删除

```
$ docker image rm centos
```

通过 `镜像摘要` 删除。

```
$ docker image ls --digests
REPOSITORY                  TAG                 DIGEST                                                                    IMAGE ID            CREATED             SIZE
node                        slim                sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228   6e0c4c8e3913        3 weeks ago         214 MB

$ docker image rm node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228
Untagged: node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228
```

结合 `docker image ls -q` 进行批量删除

例：删除所有仓库名为 `redis` 的镜像：

```
$ docker image rm $(docker image ls -q redis)
```

删除所有在 `mongo:3.2` 之前的镜像：

```
$ docker image rm $(docker image ls -q -f before=mongo:3.2)
```

### history

可以用 `docker history` 具体查看镜像内的历史记录


## 容器管理

### 启动

命令主要为 `docker run`。

下面的命令输出一个 “Hello World”，之后终止容器。

```
$ docker run ubuntu:14.04 /bin/echo 'Hello world'
Hello world
```

下面的命令则启动一个 bash 终端，允许用户进行交互。
```
$ docker run -t -i ubuntu:14.04 /bin/bash
root@af8bae53bdd3:/#
```

* `-t`: 让 Docker 分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上
* `-i`: 让容器的标准输入保持打开

通过 `--name` 指定容器的名称

```
[root@localhost ~]# docker run --name test centos /bin/echo "hello"
hello
[root@localhost ~]# docker container ls -a --format "{{.ID}} - {{.Names}}"
041b77b8845e - test
```

### 后台运行
通过添加 `-d` 参数来实现。

```
[root@localhost ~]# docker run -d centos /bin/sh -c "while true; do echo hello world; sleep 1; done"
f0a77b17adf367f97f4043d83e3645a7c78e3f9b785cd4626122877980626b15
```
要获取容器的输出信息，可以通过 `docker container logs [container ID or NAMES]` 命令。

```
[root@localhost ~]# docker container logs f0a77b17adf3
hello world
hello world
hello world
```

### 终止容器

可以使用 `docker container stop` 来终止一个运行中的容器。

此外，当 Docker 容器中指定的应用终结时，容器也自动终止。

```
docker container stop f0a77b17adf3
```

处于终止状态的容器，可以通过 `docker container start ...` 命令来重新启动。

此外，`docker container restart ...` 命令会将一个运行态的容器终止，然后再重新启动它。


### 进入容器

* 通过 `attach`

```
[root@localhost ~]# docker run -dit centos
11cf2828d1522c3dbc93a665e1bb7eb236944fe250b66945e76946be67a1cfc1

[root@localhost ~]# docker attach 11cf
[root@11cf2828d152 /]#
```

!> 注意：如果从这个 stdin 中 exit，会导致容器的停止。

* 通过 `exec` (推荐)

`docker exec` 后边可以跟多个参数，这里主要说明 `-i` `-t` 参数。

只用 `-i` 参数时，由于没有分配伪终端，界面没有我们熟悉的 Linux 命令提示符，但命令执行结果仍然可以返回。

当 `-i` `-t` 参数一起使用时，则可以看到我们熟悉的 Linux 命令提示符。

```
[root@localhost ~]# docker exec -i 3842 bash
# or
[root@localhost ~]# docker exec -it 3842 bash
```

!> 如果从这个 stdin 中 exit，不会导致容器的停止。


### 导出导入快照

导出

```
$ docker export 7691a814370e > ubuntu.tar
```

导入

```
$ cat ubuntu.tar | docker import - test/ubuntu:v1.0
```

### 删除

```
[root@localhost ~]# docker container rm 3842866f70df
```
如果要删除一个运行中的容器，可以添加 `-f` 参数。

清理所有处于终止状态的容器

```
$ docker container prune
```

### diff

查看容器的改动

```
docker diff [ID | name]
```


## 占用空间

你可以通过以下命令来便捷的查看镜像、容器、数据卷所占用的空间。
```
$ docker system df

TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE
Images              24                  0                   1.992GB             1.992GB (100%)
Containers          1                   0                   62.82MB             62.82MB (100%)
Local Volumes       9                   0                   652.2MB             652.2MB (100%)
Build Cache                                                 0B                  0B
```

## 访问仓库

| 命令 | 含义 |
| :-------|:---------
| `docker login` | 命令交互式登陆 
| `docker logout` | 退出登录 
| `docker search` | 查找官方仓库中的镜像 
| `docker pull` | 下载镜像到本地
| `docker push` | 将自己的镜像推送到 Docker Hub <br>例：`docker push username/ubuntu:17.10`


