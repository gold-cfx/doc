## 用户身份与文件权限

## 用户身份与能力

### useradd 命令

useradd 命令用于创建新的用户，格式为“useradd [选项] 用户名”。

useradd 命令中的用户参数以及作用

|参数	|作用
|:---------
|-d	|指定用户的家目录（默认为/home/username）
|-e	|账户的到期时间，格式为YYYY-MM-DD.
|-u	|指定该用户的默认UID
|-g	|指定一个初始的用户基本组（必须已存在）
|-G	|指定一个或多个扩展用户组
|-N	|不创建与用户同名的基本用户组
|-s	|指定该用户的默认 Shell 解释器


下面我们创建一个普通用户并指定家目录的路径、用户的 UID 以及 Shell 解释器。在下面的命令中，请注意/sbin/nologin，它是终端解释器中的一员，与 Bash 解释器有着天壤之别。一旦用户的解释器被设置为 nologin，则代表该用户不能登录到系统中：

```
[root@linuxprobe ~]# useradd -d /home/linux -u 8888 -s /sbin/nologin linuxprobe
[root@linuxprobe ~]# id linuxprobe
uid=8888(linuxprobe) gid=8888(linuxprobe) groups=8888(linuxprobe)
```

### groupadd 命令

groupadd 命令用于创建用户组，格式为“groupadd [选项] 群组名”。

为了能够更加高效地指派系统中各个用户的权限，在工作中常常会把几个用户加入到同一个组里面，这样便可以针对一类用户统一安排权限。创建用户组的步骤非常简单，例如使用如下命令创建一个用户组 ronny：

```
[root@linuxprobe ~]# groupadd ronny
```

### usermod 命令

usermod 命令用于修改用户的属性，格式为“usermod [选项] 用户名”。

usermod 命令中的参数及作用

|参数	|作用
|:-------
|-c	|填写用户账户的备注信息
|-d -m	|参数-m与参数-d连用，可重新指定用户的家目录并自动把旧的数据转移过去
|-e	|账户的到期时间，格式为YYYY-MM-DD
|-g	|变更所属用户组
|-G	|变更扩展用户组
|-L	|锁定用户禁止其登录系统
|-U	|解锁用户，允许其登录系统
|-s	|变更默认终端
|-u	|修改用户的UID


我们先来看一下账户 linuxprobe 的默认信息：
```
[root@linuxprobe ~]# id linuxprobe
uid=1000(linuxprobe) gid=1000(linuxprobe) groups=1000(linuxprobe)
```
然后将用户 linuxprobe 加入到 root 用户组中，这样扩展组列表中则会出现 root 用户组的字样，而基本组不会受到影响：
```
[root@linuxprobe ~]# usermod -G root linuxprobe
[root@linuxprobe ~]# id linuxprobe
uid=1000(linuxprobe) gid=1000(linuxprobe) groups=1000(linuxprobe),0(root)
```
再来试试用-u 参数修改 linuxprobe 用户的 UID 号码值。除此之外，我们还可以用-g 参数修改用户的基本组 ID，用-G 参数修改用户扩展组 ID。
```
[root@linuxprobe ~]# usermod -u 8888 linuxprobe
[root@linuxprobe ~]# id linuxprobe
uid=8888(linuxprobe) gid=1000(linuxprobe) groups=1000(linuxprobe),0(root)
```

### passwd 命令

passwd 命令用于修改用户密码、过期时间、认证信息等，格式为“passwd [选项] [用户名]”。

普通用户只能使用 passwd 命令修改自身的系统密码，而 root 管理员则有权限修改其他所有人的密码。更酷的是，root 管理员在 Linux 系统中修改自己或他人的密码时不需要验证旧密码，这一点特别方便。

passwd 命令中的参数以及作用

|参数	|作用|
|:--------
|-l	|锁定用户，禁止其登录|
|-u	|解除锁定，允许用户登录
|--stdin	|允许通过标准输入修改用户密码，<br/>如： echo "NewPassWord" &#124; passwd --stdin Username 
|-d	|使该用户可用空密码登录系统
|-e	|强制用户在下次登录时修改密码
|-S	|显示用户的密码是否被锁定，以及密码所采用的加密算法名称


如何修改用户自己的密码，以及如何修改其他人的密码（修改他人密码时，需要具有 root 管理员权限）：

```
[root@linuxprobe ~]# passwd
Changing password for user root.
New password: 此处输入密码值
Retype new password: 再次输入进行确认
passwd: all authentication tokens updated successfully.
[root@linuxprobe ~]# passwd linuxprobe
Changing password for user linuxprobe.
New password: 此处输入密码值
Retype new password: 再次输入进行确认
passwd: all authentication tokens updated successfully.
```

### userdel 命令

userdel 命令用于删除用户，格式为“userdel [选项] 用户名”。

userdel 命令的参数以及作用

|参数	|作用
|:--------
|-f	|强制删除用户
|-r	|同时删除用户及用户家目录

下面使用 userdel 命令将 linuxprobe 用户删除，其操作如下：

```
[root@linuxprobe ~]# id linuxprobe
uid=8888(linuxprobe) gid=1000(linuxprobe) groups=1000(linuxprobe),0(root)
[root@linuxprobe ~]# userdel -r linuxprobe
[root@linuxprobe ~]# id linuxprobe
id: linuxprobe: no such user
```

## 文件权限与归属

尽管在 Linux 系统中一切都是文件，但是每个文件的类型不尽相同，因此 Linux 系统使用了不同的字符来加以区分，常见的字符如下所示。

 * `-`：普通文件。
 * `d`：目录文件。
 * `l`：链接文件。
 * `b`：块设备文件。
 * `c`：字符设备文件。
 * `p`：管道文件。

对目录文件来说，“可读”表示能够读取目录内的文件列表；“可写”表示能够在目录内新增、删除、重命名文件；而“可执行”则表示能够进入该目录。


文件的读、写、执行权限可以简写为 rwx，亦可分别用数字 4、2、1 来表示，文件所有者，所属组及其他用户权限之间无关联

<table>
<caption>文件权限的字符与数字表示</caption>
<tr>
<th>权限分配</th><th colspan='3'>文件所有者</th><th colspan='3'>文件所属组</th><th colspan='3'>其他用户</th>
</tr>
<tr>
<td>权限项</td><td>读</td><td>写</td><td>执行</td><td>读</td><td>写</td><td>执行</td><td>读</td><td>写</td><td>执行</td>
</tr>
<tr>
<td>字符表示</td><td>r</td><td>w</td><td>x</td><td>r</td><td>w</td><td>x</td><td>r</td><td>w</td><td>x</td>
</tr>
<tr>
<td>数字表示</td><td>4</td><td>2</td><td>1</td><td>4</td><td>2</td><td>1</td><td>4</td><td>2</td><td>1</td>
</tr>
</table>


![](http://os6ycxx7w.bkt.clouddn.com/images/fb6d8ea5-71ba-432c-982d-9ec01f065c8c.png)

文件的类型、访问权限、所有者（属主）、所属组（属组）、占用的磁盘大小、修改时间和文件名称。


## 文件的特殊权限

### SUID

SUID 是一种对二进制程序进行设置的特殊权限，可以让二进制程序的执行者临时拥有属主的权限（仅对拥有执行权限的二进制程序有效）。

### SGID

SGID 主要实现如下两种功能：
 * 让执行者临时拥有属组的权限（对拥有执行权限的二进制程序进行设置）；
 * 在某个目录中创建的文件自动继承该目录的用户组（只可以对目录进行设置）。

### SBIT

SBIT 特殊权限位可确保用户只能删除自己的文件，而不能删除其他用户的文件。换句话说，当对某个目录设置了 SBIT 粘滞位权限后，那么该目录中的文件就只能被其所有者执行删除操作了。



