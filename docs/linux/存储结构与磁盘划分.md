## 存储结构与磁盘划分

![](http://os6ycxx7w.bkt.clouddn.com/images/fb2fff89-4b33-4acc-9455-e52b2d5cdeb2.gif)

Linux 系统中常见的目录名称以及相应内容

|目录名称	|应放置文件的内容|
|:---------
|/boot	|开机所需文件—内核、开机菜单以及所需配置文件等
|/dev	|以文件形式存放任何设备与接口
|/etc	|配置文件
|/home	|用户家目录
|/bin	|存放单用户模式下还可以操作的命令
|/lib	|开机时用到的函数库，以及/bin与/sbin下面的命令要调用的函数
|/sbin	|开机过程中需要的命令
|/media	|用于挂载设备文件的目录
|/opt	|放置第三方的软件
|/root	|系统管理员的家目录
|/srv	|一些网络服务的数据文件目录
|/tmp	|任何人均可使用的“共享”临时目录
|/proc	|虚拟文件系统，例如系统内核、进程、外部设备及网络状态等
|/usr/local	|用户自行安装的软件
|/usr/sbin	|Linux系统开机时不会使用到的软件/命令/脚本
|/usr/share	|帮助与说明文件，也可放置共享文件
|/var	|主要存放经常变化的文件，如日志
|/lost+found	|当文件系统发生错误时，将一些丢失的文件片段存放在这里

## /usr 的意义与内容：

很多读者都会误会/usr为user的缩写，其实usr是Unix Software Resource的缩写， 也就是『Unix操作系统软件资源』所放置的目录，而不是用户的数据啦！这点要注意。 FHS建议所有软件开发者，应该将他们的数据合理的分别放置到这个目录下的次目录，而不要自行建立该软件自己独立的目录。

因为是所有系统默认的软件(distribution发布者提供的软件)都会放置到/usr底下，因此这个目录有点类似Windows 系统的『C:\Windows\ + C:\Program files\』这两个目录的综合体，系统刚安装完毕时，这个目录会占用最多的硬盘容量。 一般来说，/usr的次目录建议有底下这些：

| 目录      |     应放置文件内容 |  
| :-------- | :--------|
| /usr/X11R6/    |   为X Window System重要数据所放置的目录，之所以取名为X11R6是因为最后的X版本为第11版，且该版的第6次释出之意。 |  
|/usr/bin/	|绝大部分的用户可使用指令都放在这里！请注意到他与/bin的不同之处。(是否与开机过程有关)
|/usr/include/	|c/c++等程序语言的档头(header)与包含档(include)放置处，当我们以tarball方式 (*.tar.gz 的方式安装软件)安装某些数据时，会使用到里头的许多包含档喔！
|/usr/lib/	|包含各应用软件的函式库、目标文件(object file)，以及不被一般使用者惯用的执行档或脚本(script)。 某些软件会提供一些特殊的指令来进行服务器的设定，这些指令也不会经常被系统管理员操作， 那就会被摆放到这个目录下啦。要注意的是，如果你使用的是X86_64的Linux系统， 那可能会有/usr/lib64/目录产生喔！
|/usr/local/	|系统管理员在本机自行安装自己下载的软件(非distribution默认提供者)，建议安装到此目录， 这样会比较便于管理。举例来说，你的distribution提供的软件较旧，你想安装较新的软件但又不想移除旧版， 此时你可以将新版软件安装于/usr/local/目录下，可与原先的旧版软件有分别啦！ 你可以自行到/usr/local去看看，该目录下也是具有bin, etc, include, lib...的次目录喔！
|/usr/sbin/	|非系统正常运作所需要的系统指令。最常见的就是某些网络服务器软件的服务指令(daemon)啰！
|/usr/share/	|放置共享文件的地方，在这个目录下放置的数据几乎是不分硬件架构均可读取的数据， 因为几乎都是文本文件嘛！在此目录下常见的还有这些次目录：<br/> **/usr/share/man：联机帮助文件** <br/>**/usr/share/doc：软件杂项的文件说明** <br/>**/usr/share/zoneinfo：与时区有关的时区文件**
|/usr/src/	|一般原始码建议放置到这里，src有source的意思。至于核心原始码则建议放置到/usr/src/linux/目录下。


## 物理设备的命名规则

|硬件设备	|文件名称
|:-------
|IDE设备	|/dev/hd[a-d]
|SCSI/SATA/U盘	|/dev/sd[a-p]
|软驱	|/dev/fd[0-1]
|打印机	|/dev/lp[0-15]
|光驱	|/dev/cdrom
|鼠标	|/dev/mouse
|磁带机	|/dev/st0或/dev/ht0


硬盘设备是由大量的扇区组成的，每个扇区的容量为 512 字节。其中第一个扇区最重要，它里面保存着主引导记录与分区表信息。就第一个扇区来讲，主引导记录需要占用 446 字节，分区表为 64 字节，结束符占用 2 字节；其中分区表中每记录一个分区信息就需要 16 字节，这样一来最多只有 4 个分区信息可以写到第一个扇区中，这 4 个分区就是 4 个主分区。

第一个扇区中的数据信息
![](http://os6ycxx7w.bkt.clouddn.com/images/b680f983-82e2-4d05-9399-ba6c55269d62.png)

硬盘分区的规划

![](http://os6ycxx7w.bkt.clouddn.com/images/63cfcc33-431a-4be8-9c60-e6d7eb45d9c2.png)

!> 所谓扩展分区，严格地讲它不是一个实际意义的分区，它仅仅是一个指向下一个分区的指针，这种指针结构将形成一个单向链表。

## 文件系统与数据资料


* Ext3：是一款日志文件系统，能够在系统异常宕机时避免文件系统资料丢失，并能自动修复数据的不一致与错误。然而，当硬盘容量较大时，所需的修复时间也会很长，而且也不能百分之百地保证资料不会丢失。它会把整个磁盘的每个写入动作的细节都预先记录下来，以便在发生异常宕机后能回溯追踪到被中断的部分，然后尝试进行修复。
* Ext4：Ext3的改进版本，作为RHEL 6系统中的默认文件管理系统，它支持的存储容量高达1EB（1EB=1,073,741,824GB），且能够有无限多的子目录。另外，Ext4文件系统能够批量分配block块，从而极大地提高了读写效率。
* XFS：是一种高性能的日志文件系统，而且是RHEL 7中默认的文件管理系统，它的优势在发生意外宕机后尤其明显，即可以快速地恢复可能被破坏的文件，而且强大的日志功能只用花费极低的计算和存储性能。并且它最大可支持的存储容量为18EB，这几乎满足了所有需求。


## 挂载硬件设备


### mount 命令
mount 命令用于挂载文件系统，格式为“mount 文件系统 挂载目录”。

|参数	|作用
|:-------
|-a	|挂载所有在/etc/fstab中定义的文件系统
|-t	|指定文件系统的类型

例如，要把设备/dev/sdb2 挂载到/backup 目录，只需要在 mount 命令中填写设备与挂载目录参数就行，系统会自动去判断要挂载文件的类型，因此只需要执行下述命令即可：

```
[root@linuxprobe ~]# mount /dev/sdb2 /backup
```

虽然按照上面的方法执行 mount 命令后就能立即使用文件系统了，但系统在重启后挂载就会失效，也就是说我们需要每次开机后都手动挂载一下。

如果想让硬件设备和目录永久地进行自动关联，就必须把挂载信息按照指定的填写格式 “设备文件 挂载目录 格式类型 权限选项 是否备份 是否自检” 写入到 /etc/fstab 文件中。

用于挂载信息的指定填写格式中，各字段所表示的意义

|字段	|意义
|:-------
|设备文件	|一般为设备的路径+设备名称，也可以写唯一识别码（UUID，Universally Unique Identifier）
|挂载目录	|指定要挂载到的目录，需在挂载前创建好
|格式类型	|指定文件系统的格式，比如Ext3、Ext4、XFS、SWAP、iso9660（此为光盘设备）等
|权限选项	|若设置为defaults，则默认权限为：rw, suid, dev, exec, auto, nouser, async
|是否备份	|若为1则开机后使用dump进行磁盘备份，为0则不备份
|是否自检	|若为1则开机后自动进行磁盘自检，为0则不自检


如果想将文件系统为 ext4 的硬件设备/dev/sdb2 在开机后自动挂载到/backup 目录上，并保持默认权限且无需开机自检，就需要在/etc/fstab 文件中写入下面的信息，这样在系统重启后也会成功挂载。

```
[root@linuxprobe ~]# vim /etc/fstab
#
# /etc/fstab
# Created by anaconda on Wed May 4 19:26:23 2017
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
/dev/mapper/rhel-root                     /            xfs       defaults   1 1
UUID=812b1f7c-8b5b-43da-8c06-b9999e0fe48b /boot        xfs       defaults   1 2
/dev/mapper                               /rhel-swap   swap swap defaults   0 0
/dev/cdrom                                /media/cdrom iso9660   defaults   0 0
/dev/sdb2                                 /backup      ext4      defaults   0 0

```

### umount 命令

umount 命令用于撤销已经挂载的设备文件，格式为“umount [挂载点/设备文件]”。

```
[root@linuxprobe ~]# umount /dev/sdb2
```

## 软硬方式链接

在 Linux 系统中存在硬链接和软连接两种文件。

* 硬链接（hard link）：可以将它理解为一个“指向原始文件inode的指针”，系统不为它分配独立的inode和文件。所以，硬链接文件与原始文件其实是同一个文件，只是名字不同。我们每添加一个硬链接，该文件的inode连接数就会增加1；而且只有当该文件的inode连接数为0时，才算彻底将它删除。换言之，由于硬链接实际上是指向原文件inode的指针，因此即便原始文件被删除，依然可以通过硬链接文件来访问。需要注意的是，由于技术的局限性，我们不能跨分区对目录文件进行链接。
* 软链接（也称为符号链接[symbolic link]）：仅仅包含所链接文件的路径名，因此能链接目录文件，也可以跨越文件系统进行链接。但是，当原始文件被删除后，链接文件也将失效，从这一点上来说与Windows系统中的“快捷方式”具有一样的性质。
### ln 命令

ln 命令用于创建链接文件，格式为“ln [选项] 目标”

|参数	|作用
|:------
|-s	|创建“符号链接”（如果不带-s参数，则默认创建硬链接）
|-f	 |强制创建文件或目录的链接
|-i	 |覆盖前先询问
|-v	|显示创建链接的过程
